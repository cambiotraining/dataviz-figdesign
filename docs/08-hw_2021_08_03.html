<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Homework 03 August 2021</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="assets/styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-sm-12 col-md-4 col-lg-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-sm-12 col-md-8 col-lg-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"><img id="logo" style="height: 25px;" src="assets/img/logo.svg" /></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="99-setup.html">Setup</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Materials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="00-getting-started.html">Getting Started</a>
    </li>
    <li>
      <a href="01-intro-to-r.html">Introduction to R</a>
    </li>
    <li>
      <a href="02-starting-with-data.html">Starting With Data</a>
    </li>
    <li>
      <a href="03-intro-ggplot2.html">Data visualisation</a>
    </li>
    <li>
      <a href="05-customising-plots.html">Customising Plots</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Homework
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="06-hw_2021_07_20.html">20 July 2021</a>
    </li>
    <li>
      <a href="07-hw_2021_07_27.html">27 July 2021</a>
    </li>
    <li>
      <a href="08-hw_2021_08_03.html">03 August 2021</a>
    </li>
    <li class="dropdown-header">12 August 2021</li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Extras
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="10-cheatsheets.html">Cheatsheets</a>
    </li>
    <li>
      <a href="11-resources.html">Other Resources</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/cambiotraining">GitHub</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Homework 03 August 2021</h1>

</div>


<p>These exercises continue from last week’s, so you need to make sure you’ve read the gapminder dataset:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>gapminder &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data_raw/gapminder2010_socioeconomic.csv&quot;</span>)</span></code></pre></div>
<div id="task-5" class="section level2">
<h2>Task 5</h2>
<p>Let’s take the scatterplot from our previous exercise and continue working on it:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder, </span>
<span id="cb2-2"><a href="#cb2-2"></a>       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> life_expectancy, <span class="dt">y =</span> income_per_person)) <span class="op">+</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="st">  </span><span class="kw">geom_point</span>()</span></code></pre></div>
<p><img src="img/R-ecology-08-unnamed-chunk-3-1.png" width="672" /></p>
<ol style="list-style-type: decimal">
<li>Colour the points brown, make them 80% transparent and increase their size.</li>
<li>Add a smooth trend line to the plot.
<details>
<summary>Hint</summary>Use <code>geom_smooth()</code> to add a trend line to the data.
</details></li>
<li>Modify the previous plot and colour the points by the variable “world_region”.</li>
<li>Assign (<code>&lt;-</code>) the plot to an appropriately named object.</li>
</ol>
<details>
<p><summary>Answer</summary></p>
<p>We can use the options <code>colour</code>, <code>alpha</code> (transparency) and <code>size</code> to modify the points as requested:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder, </span>
<span id="cb3-2"><a href="#cb3-2"></a>       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> life_expectancy, <span class="dt">y =</span> income_per_person)) <span class="op">+</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;brown&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.8</span>, <span class="dt">size =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>#&gt; Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="img/R-ecology-08-unnamed-chunk-4-1.png" width="672" /></p>
<p>To add a trend line, we add a new geometry to our plot:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder, </span>
<span id="cb5-2"><a href="#cb5-2"></a>       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> life_expectancy, <span class="dt">y =</span> income_per_person)) <span class="op">+</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">colour =</span> <span class="st">&quot;brown&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.8</span>, <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="st">  </span><span class="kw">geom_smooth</span>()</span></code></pre></div>
<pre><code>#&gt; `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<pre><code>#&gt; Warning: Removed 6 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>#&gt; Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="img/R-ecology-08-unnamed-chunk-5-1.png" width="672" /></p>
<p>To colour the points by a variable, we move the <code>colour</code> option into the <code>aes()</code> giving it the variable name instead of a colour name (ggplot takes care of picking some default colours for us):</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder, </span>
<span id="cb9-2"><a href="#cb9-2"></a>       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> life_expectancy, <span class="dt">y =</span> income_per_person)) <span class="op">+</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> world_region)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="st">  </span><span class="kw">geom_smooth</span>()</span></code></pre></div>
<pre><code>#&gt; `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<pre><code>#&gt; Warning: Removed 6 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>#&gt; Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="img/R-ecology-08-unnamed-chunk-6-1.png" width="672" /></p>
<p>To save the plot into an object, we use the assignment operator <code>&lt;-</code>, like so:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>income_life_expectancy_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> gapminder, </span>
<span id="cb13-2"><a href="#cb13-2"></a>                                      <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> life_expectancy, <span class="dt">y =</span> income_per_person)) <span class="op">+</span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour=</span>world_region)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="st">  </span><span class="kw">geom_smooth</span>()</span></code></pre></div>
<p>Note: assigning it to a variable helps your code stay clean and also helps when it comes to saving plots.</p>
<p>If you want to see the plot, you have to print it on the console</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>income_life_expectancy_plot</span></code></pre></div>
<pre><code>#&gt; `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<pre><code>#&gt; Warning: Removed 6 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>#&gt; Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="img/R-ecology-08-unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="task-6" class="section level2">
<h2>Task 6</h2>
<ol style="list-style-type: decimal">
<li>Using facets, split your scatter plot from the previous task by the variable <code>is_oecd</code>.
<details>
<summary>Hint</summary>Clicking the “Zoom” button on the bottom right “Plots” panel of RStudio to see your facetted graph much better (and any other graph for that matter!).
</details></li>
<li>Modify the previous code to facet your plot by <code>main_religion</code>. Do you identify any issues in this visualisation?</li>
<li>Finally, try facetting by <code>children_per_woman</code>. What do you think about this visualisation?</li>
</ol>
<details>
<p><summary>Answer</summary></p>
<p>We can use the <code>facet_wrap()</code> function to achieve this:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>income_life_expectancy_plot  <span class="op">+</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="dt">facets =</span> <span class="kw">vars</span>(is_oecd))</span></code></pre></div>
<pre><code>#&gt; `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<pre><code>#&gt; Warning: Removed 6 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>#&gt; Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="img/R-ecology-08-unnamed-chunk-9-1.png" width="672" /></p>
<p>To facet by a different variable, we can adapt the code above and just replace the variable we are facetting by:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>income_life_expectancy_plot  <span class="op">+</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="dt">facets =</span> <span class="kw">vars</span>(main_religion))</span></code></pre></div>
<pre><code>#&gt; `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<pre><code>#&gt; Warning: Removed 6 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
#&gt; parametric, : span too small. fewer data values than degrees of freedom.</code></pre>
<pre><code>#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
#&gt; parametric, : pseudoinverse used at 63.703</code></pre>
<pre><code>#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
#&gt; parametric, : neighborhood radius 5.9872</code></pre>
<pre><code>#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
#&gt; parametric, : reciprocal condition number 0</code></pre>
<pre><code>#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
#&gt; parametric, : There are other near singularities as well. 35.488</code></pre>
<pre><code>#&gt; Warning in predLoess(object$y, object$x, newx = if
#&gt; (is.null(newdata)) object$x else if (is.data.frame(newdata))
#&gt; as.matrix(model.frame(delete.response(terms(object)), : span too small. fewer
#&gt; data values than degrees of freedom.</code></pre>
<pre><code>#&gt; Warning in predLoess(object$y, object$x, newx = if
#&gt; (is.null(newdata)) object$x else if (is.data.frame(newdata))
#&gt; as.matrix(model.frame(delete.response(terms(object)), : pseudoinverse used at
#&gt; 63.703</code></pre>
<pre><code>#&gt; Warning in predLoess(object$y, object$x, newx = if
#&gt; (is.null(newdata)) object$x else if (is.data.frame(newdata))
#&gt; as.matrix(model.frame(delete.response(terms(object)), : neighborhood radius
#&gt; 5.9872</code></pre>
<pre><code>#&gt; Warning in predLoess(object$y, object$x, newx = if
#&gt; (is.null(newdata)) object$x else if (is.data.frame(newdata))
#&gt; as.matrix(model.frame(delete.response(terms(object)), : reciprocal condition
#&gt; number 0</code></pre>
<pre><code>#&gt; Warning in predLoess(object$y, object$x, newx = if
#&gt; (is.null(newdata)) object$x else if (is.data.frame(newdata))
#&gt; as.matrix(model.frame(delete.response(terms(object)), : There are other near
#&gt; singularities as well. 35.488</code></pre>
<pre><code>#&gt; Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<pre><code>#&gt; Warning in max(ids, na.rm = TRUE): no non-missing arguments to max; returning -
#&gt; Inf</code></pre>
<p><img src="img/R-ecology-08-unnamed-chunk-10-1.png" width="672" /></p>
<p>This is where we can clearly see how the spelling/formatting mistakes affect our data. Variables are recognised as different if capitalisation is different e.g. “christian” vs “Christian”. There is also a more subtle typo between “eastern religions” (one space between words) and “eastern religions” (two spaces between words). We turn to try and fix this problem in the next exercise.</p>
<p>Finally, we were asked to facet by <code>children_per_woman</code></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>income_life_expectancy_plot <span class="op">+</span></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="dt">facets =</span> <span class="kw">vars</span>(children_per_woman))</span></code></pre></div>
<pre><code>#&gt; `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="img/R-ecology-08-unnamed-chunk-11-1.png" width="672" /></p>
<p>This “works” (as in, the code gives no error). But it is very messy and not informative! This is a good example of how NOT to present data - this would be a more suitable variable to use for “coloured by” as opposed to facet.</p>
</details>
</div>
<div id="task-7" class="section level2">
<h2>Task 7</h2>
<p>In previous exercises we have seen that the <code>main_religion</code> column contains several typos. The <code>stringr</code> package (part of <code>tidyverse</code>) is very useful to correct these kinds of mistakes. For example, the function <code>str_squish()</code> removes any whitespaces inside a string. While the function <code>str_to_lower()</code> converts words to lowercase.</p>
<p>You have also seen how to use the <code>mutate()</code> function to <em>modify</em> a column in your table. For example:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">income_total =</span> population <span class="op">*</span><span class="st"> </span>income_per_person)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Use <code>mutate()</code>, <code>str_squish()</code> and <code>str_to_lower()</code> to fix the typos in the <code>main_religion</code> column in our table.</li>
</ol>
<details>
<p><summary>Answer</summary></p>
<p>We can pipe two <code>mutate()</code> commands, at each step modifying the column with one of the <code>str_*()</code> functions:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>gapminder &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">main_religion =</span> <span class="kw">str_squish</span>(main_religion)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb40-3"><a href="#cb40-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">main_religion =</span> <span class="kw">str_to_lower</span>(main_religion))</span></code></pre></div>
<p>Alternatively, we could have also done both tasks at once by “nesting” one function inside the other:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>gapminder <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">main_religion =</span> <span class="kw">str_squish</span>(<span class="kw">str_to_lower</span>(main_religion)))</span></code></pre></div>
<p>We can check that the issue has been solved, for example by re-doing our plot facetted by this variable:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="co"># create new version of the base plot</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>income_life_expectancy_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(life_expectancy, income_per_person)) <span class="op">+</span></span>
<span id="cb42-3"><a href="#cb42-3"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb42-4"><a href="#cb42-4"></a><span class="st">  </span><span class="kw">geom_smooth</span>()</span>
<span id="cb42-5"><a href="#cb42-5"></a></span>
<span id="cb42-6"><a href="#cb42-6"></a><span class="co"># plot with facets</span></span>
<span id="cb42-7"><a href="#cb42-7"></a>income_life_expectancy_plot <span class="op">+</span></span>
<span id="cb42-8"><a href="#cb42-8"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="dt">facets =</span> <span class="kw">vars</span>(main_religion))</span></code></pre></div>
<pre><code>#&gt; `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<pre><code>#&gt; Warning: Removed 6 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>#&gt; Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="img/R-ecology-08-unnamed-chunk-15-1.png" width="672" /></p>
</details>
</div>
<div id="task-8" class="section level2">
<h2>Task 8</h2>
<p>Make a violin + boxplot of main_religion (x-axis) by income_per_person (y-axis) - where the violin is coloured by the x variable but the boxplot is not (it is white by default). Give the boxplot a width of 0.25.</p>
<p>In terms of figure design, what do you think about our choice of colouring the inside of the violin plots by main_religion?</p>
<details>
<p><summary>Answer</summary></p>
<p>We can make the desired plot by passing the <code>fill</code> aesthetic to the <code>geom_violin()</code> only, and we can set the <code>width</code> option in <code>geom_boxplot()</code>:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(<span class="dt">x =</span> main_religion, <span class="dt">y =</span> income_per_person)) <span class="op">+</span></span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="st">  </span><span class="kw">geom_violin</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> main_religion)) <span class="op">+</span></span>
<span id="cb46-3"><a href="#cb46-3"></a><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">width =</span> <span class="fl">0.25</span>)</span></code></pre></div>
<p><img src="img/R-ecology-08-unnamed-chunk-16-1.png" width="672" /></p>
<p>Colouring the violin plots by <code>main_religion</code> is redundant with the x-axis, so it doesn’t seem justified in this case. Maybe if this plot was part of a series of other plots where the colouring was necessary, then it might make sense to colour them, for consistency across figure panels. In that case, we could still improve this plot by remove the colour legend on the right, to de-clutter the plot (we will see how to do this in the next lesson).</p>
</details>
</div>
<div id="task-9" class="section level2">
<h2>Task 9</h2>
<ol style="list-style-type: decimal">
<li>Split your scatter plot by rows and columns. Row = <code>is_oecd</code>, Columns = <code>main_religion</code>.</li>
<li>Apart from the warning related to 6 missing values, we get other warnings. What do you think these are related to?</li>
</ol>
<details>
<p><summary>Answer</summary></p>
<p>In this case, we want to use <code>facet_grid()</code>, which lets us split the plot by “rows” and “columns” on a grid:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>income_life_expectancy_plot  <span class="op">+</span></span>
<span id="cb47-2"><a href="#cb47-2"></a><span class="st">  </span><span class="kw">facet_grid</span>(<span class="dt">rows =</span> <span class="kw">vars</span>(is_oecd), <span class="dt">cols =</span> <span class="kw">vars</span>(main_religion))</span></code></pre></div>
<pre><code>#&gt; `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<pre><code>#&gt; Warning: Removed 6 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
#&gt; parametric, : span too small. fewer data values than degrees of freedom.</code></pre>
<pre><code>#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
#&gt; parametric, : at 80.614</code></pre>
<pre><code>#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
#&gt; parametric, : radius 3.6603e-05</code></pre>
<pre><code>#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
#&gt; parametric, : all data on boundary of neighborhood. make span bigger</code></pre>
<pre><code>#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
#&gt; parametric, : pseudoinverse used at 80.614</code></pre>
<pre><code>#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
#&gt; parametric, : neighborhood radius 0.00605</code></pre>
<pre><code>#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
#&gt; parametric, : reciprocal condition number 1</code></pre>
<pre><code>#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
#&gt; parametric, : at 81.836</code></pre>
<pre><code>#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
#&gt; parametric, : radius 3.6603e-05</code></pre>
<pre><code>#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
#&gt; parametric, : all data on boundary of neighborhood. make span bigger</code></pre>
<pre><code>#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
#&gt; parametric, : There are other near singularities as well. 3.6603e-05</code></pre>
<pre><code>#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
#&gt; parametric, : zero-width neighborhood. make span bigger

#&gt; Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
#&gt; parametric, : zero-width neighborhood. make span bigger</code></pre>
<pre><code>#&gt; Warning: Computation failed in `stat_smooth()`:
#&gt; NA/NaN/Inf in foreign function call (arg 5)</code></pre>
<pre><code>#&gt; Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<p><img src="img/R-ecology-08-unnamed-chunk-17-1.png" width="672" /></p>
<p>The warnings we get are from <code>geom_smooth()</code>, which in some groups has such few points that it cannot make a smooth line (e.g. very few countries that are both part of the OECD and where the main religion falls in the category “eastern religions”).</p>
</details>
</div>
<div id="task-10" class="section level2">
<h2>Task 10</h2>
<ol style="list-style-type: decimal">
<li>Save one of the plots (of your choice) to a file with appropriate file name. Choose the one you think best represents the data and think why.</li>
</ol>
<details>
<p><summary>Answer</summary></p>
<p>We can use the <code>ggsave()</code> function to achieve this:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="kw">ggsave</span>(<span class="dt">filename =</span> <span class="st">&quot;img_output/plot_income_lifeExpt_trend.png&quot;</span>, </span>
<span id="cb64-2"><a href="#cb64-2"></a>       <span class="dt">plot =</span> income_life_expectancy_plot)</span></code></pre></div>
<p>The extension we use in the filename is important, as it will determine the file format that the plot will be saved as. In this case we’re saving it as a <em>PNG</em> file. Another good option is to save as a <em>PDF</em> file (<code>.pdf</code> extension).</p>
<p>We chose to just save the plot pre-facetting. This is because, sometimes, too many variables represented in a single plot confuses things and makes it extremely hard to interpret (and very easy to misinterpret!).</p>
</details>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
